#!/usr/abu/pico/bin/pico /usr/abu/pico/lib.l
# 18dec03abu

# *Port *Sock *Name

(de chat Lst
   (out *Sock
      (mapc prin Lst)
      (prinl) ) )


(setq *Port (port 4004))

(loop
   (setq *Sock (listen *Port))
   (NIL (fork) (close *Port))
   (close *Sock) )

(out *Sock
   (prin "Please enter your name: ")
   (flush) )
(in *Sock (setq *Name (line T)))

(tell 'chat "+++ " *Name " arrived +++")

(task *Sock
   (ifn (=T (in *Sock (setq "Line" (line T))))
      (tell 'chat *Name "> " "Line")
      (tell 'chat "--- " *Name " left ---")
      (bye) ) )
(wait)
