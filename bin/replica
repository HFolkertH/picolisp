#!bin/pico lib.l
# 21mar05abu
# Use: bin/replica <dbFile> <port> <keyFile> [<journal>]

(load "@lib/misc.l" "@lib/http.l")

(allowed NIL "@replica")

(argv *DbFile *Port *SSLKey *Journal)

(setq
   *Port (format *Port)
   *SSLKey (in *SSLKey (read)) )

(de replica ()
   (protect
      (and
         (= (read) *SSLKey)
         (read)
         (out (tmp 'replica) (echo 1 @))
         (ctl *DbFile (in (tmp 'replica) (journal))) ) ) )

(pool *DbFile *Journal)
(server *Port)
